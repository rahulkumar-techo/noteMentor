# .github/workflows/ci-dev.yml
# âœ… CI pipeline for NoteMentor (development branch)
# ---------------------------------------------------
# Tasks:
# 1ï¸âƒ£ Install dependencies
# 2ï¸âƒ£ Run lint + tests
# 3ï¸âƒ£ Build Docker image
# 4ï¸âƒ£ Push to DockerHub (optional)
# 5ï¸âƒ£ Notify build status

name: CI Dev Pipeline

on:
  push:
    branches: ["dev"]
  pull_request:
    branches: ["dev"]

jobs:
  build:
    name: ğŸ§± Build and Test
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: ğŸ“¥ Install dependencies
        run: npm ci

      - name: ğŸ§¹ Run ESLint
        run: npm run lint --if-present

      - name: ğŸ§ª Run Tests
        run: npm test --if-present

      - name: ğŸ—ï¸ Build App
        run: npm run build --if-present

  docker:
    name: ğŸ³ Docker Build & Push
    needs: build
    runs-on: ubuntu-latest
    if: ${{ success() }}

    steps:
      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Log in to DockerHub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: ğŸ—ï¸ Build Docker image
        run: |
          docker build -t ${{ secrets.DOCKER_USERNAME }}/notementor-dev:latest .

      - name: ğŸš€ Push Docker image
        run: |
          docker push ${{ secrets.DOCKER_USERNAME }}/notementor-dev:latest

  notify:
    name: ğŸ“¢ Notify Build Status
    needs: [docker]
    runs-on: ubuntu-latest
    if: always()

    steps:
      - name: ğŸª¶ Notify CI status
        run: |
          echo "âœ… CI completed for dev branch with status: ${{ needs.docker.result }}"
